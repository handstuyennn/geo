# name: test/sql/function/test_geofromwkb.test
# description: ST_GEOMFROMWKB/ST_GEOGFROMWKB test
# group: [function]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE geographies(g Geography)

statement ok
INSERT INTO geographies VALUES(ST_GEOGFROMWKB('\x01\x01\x00\x00\x00)\x5C\x8F\xC2\xF5(\x14@\xE1z\x14\xAEG\xE1%@'::BLOB)),(ST_GEOGFROMWKB('\x01\x02\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00\x00\x00\x00\x08@\x00\x00\x00\x00\x00\x00\x08@\x00\x00\x00\x00\x00\x00\x10@\x00\x00\x00\x00\x00\x00\x10@'::BLOB)),(ST_GEOGFROMWKB(NULL))

query R
select ST_ASTEXT(g) from geographies
----
POINT(5.04 10.94)
LINESTRING(1 1,2 2,3 3,4 4)
NULL

# test with null and empty
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES(ST_GEOGFROMWKB(''::BLOB)), (ST_GEOMFROMWKB(NULL))

query R
select ST_ASTEXT(g) from geographies
----
(empty)
NULL

query I
SELECT ST_ASTEXT(ST_GEOGFROMWKB('\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\xF0?'::BLOB))
----
POINT(1 1)

query I
SELECT ST_ASTEXT(ST_GEOGFROMWKB('\x01\x04\x00\x00\x00\x06\x00\x00\x00\x01\x01\x00\x00\x00\xCD\xCC\xCC\xCC\xCC\xCC\xEC?\xCD\xCC\xCC\xCC\xCC\xCC\xEC?\x01\x01\x00\x00\x00\xCD\xCC\xCC\xCC\xCC\xCC\xEC?\xCD\xCC\xCC\xCC\xCC\xCC\xEC?\x01\x01\x00\x00\x00\xCD\xCC\xCC\xCC\xCC\xCC\xEC?\xCD\xCC\xCC\xCC\xCC\xCC\xEC?\x01\x01\x00\x00\x00\xCD\xCC\xCC\xCC\xCC\xCC\xEC?\xCD\xCC\xCC\xCC\xCC\xCC\xEC?\x01\x01\x00\x00\x00\xCD\xCC\xCC\xCC\xCC\xCC\xEC?\xCD\xCC\xCC\xCC\xCC\xCC\xEC?\x01\x01\x00\x00\x00\xCD\xCC\xCC\xCC\xCC\xCC\xEC?\xCD\xCC\xCC\xCC\xCC\xCC\xEC?'::BLOB))
----
MULTIPOINT(0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9)

query I
SELECT ST_ASTEXT(ST_GEOGFROMWKB('\x01\x05\x00\x00\xC0\x02\x00\x00\x00\x01\x02\x00\x00\xC0\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x14@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00\x00\x00\x00\x14@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10@\x01\x02\x00\x00\xC0\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\x08@\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\x08@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xF0?'::BLOB))
----
MULTILINESTRING ZM ((0 0 0 1,0 5 0 2,5 0 0 3,0 0 0 4),(1 1 0 1,3 1 0 1,1 3 0 1,1 1 0 1))

query I
SELECT ST_ASTEXT(ST_GEOGFROMWKB('\x01\x02\x00\x00\x00\x03\x00\x00\x00\xE4J=\x0BB\xCAQ\xC0n\xC3(\x08\x1E!E@\x27\xBFE\x27K\xCAQ\xC0\xF6{b\x9D*!E@\x95|\xEC.P\xCAQ\xC0p\x99\xD3e1!E@'::BLOB))
----
LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)

query I
SELECT ST_ASTEXT(ST_GEOGFROMWKB('\x01\x03\x00\x00\x00\x01\x00\x00\x00!\x00\x00\x00\x9F\x9E\xB2\xD4\x1B\xF3`@\x00\x00\x00\x00\x00\x00.@2\xD45\xE6O\xCC`@/\xB5[\x00\xDA\x85\x05@n\xA4u\xC8iY`@\x00\x00\x00\x00\x00\x80V@\xAA]M\xB3\xA7=_@\xFD\x1C\xF7\x91|\xFCS@D\xF2\xFDosG]@\xCA\x0D\x02\x90\x8C\x98Q@\x0A\xE3\x08n\x83\xE3Z@\x81De\x99\xB0DO@\xE8\x8BF\xE1[)X@In)\xDEXZL@O\x22\xFD/\xD13U@9\xAF(g\xC0\x8EJ@\x07\x00\x00\x00\x00 R@\xA0\x855\xAD\x90\xF3I@}\xBB\x05\xA0]\x18N@*\xAF(g\xC0\x8EJ@M\xE8r=H-H@;n)\xDEXZL@\x07:\xEE#\xF9\xB8B@sDe\x99\xB0DO@(7\x08@2\xE2;@\xBC\x0D\x02\x90\x8C\x98Q@\x1E\x89\xCA2a\x094@\xEF\x1C\xF7\x91|\xFCS@$\xB9\xA5xci,@\x00\x00\x00\x00\x00\x80V@\xE2\xBC\xA2\x9C\x01;%@/\xB5[\x00\xDA\x85\x05@y\x16\xD6\xB4B\xCE\x22@\x00\x00\x00\x00\x00\x00.@\xAA\xBC\xA2\x9C\x01;%@Z\x89\xF4\xBFDO;@\xEB\xB8\xA5xci,@{\x17\x8D\xC2\xB7\x92C@\xCA\x88\xCA2a\x094@\x15\xC6\x11\xDC\x06\x07I@\xF06\x08@2\xE2;@\x88\xE4\xFB\xDF\xE6\xCEM@\xCF9\xEE#\xF9\xB8B@\xAA]M\xB3\xA7\xDDP@\x14\xE8r=H-H@\xDCH\xEB\x90\xD3RR@S\xBB\x05\xA0]\x18N@d\xA8k\xCC\x9F8S@\xF2\xFF\xFF\xFF\xFF\x1FR@>=e\xA97\x86S@:\x22\xFD/\xD13U@d\xA8k\xCC\x9F8S@\xD3\x8BF\xE1[)X@\xDCH\xEB\x90\xD3RR@\x0A\xE3\x08n\x83\xE3Z@\xAA]M\xB3\xA7\xDDP@D\xF2\xFDosG]@\x88\xE4\xFB\xDF\xE6\xCEM@\xAA]M\xB3\xA7=_@\x15\xC6\x11\xDC\x06\x07I@n\xA4u\xC8iY`@\x08\x18\x8D\xC2\xB7\x92C@2\xD45\xE6O\xCC`@Z\x89\xF4\xBFDO;@\x9F\x9E\xB2\xD4\x1B\xF3`@\x00\x00\x00\x00\x00\x00.@'::BLOB))
----
POLYGON((135.59714732062 15,134.384753327498 2.690357210921,130.79416296937 90,124.963360620072 79.9451031602111,117.116420743937 70.3835792560632,107.554896839789 62.5366393799277,96.6462329091006 56.70583703063,84.8096427890789 53.115246672502,72.5000000000001 51.9028526793802,60.1903572109213 53.1152466725019,48.3537670908996 56.7058370306299,37.4451031602112 62.5366393799276,27.8835792560632 70.383579256063,20.0366393799278 79.9451031602109,14.20583703063 90,10.615246672502 2.690357210921,9.40285267938019 15,10.6152466725019 27.309642789079,14.2058370306299 39.1462329091,20.0366393799275 50.054896839789,27.883579256063 59.616420743937,37.4451031602108 67.463360620072,48.3537670908992 73.29416296937,60.190357210921 76.884753327498,72.4999999999998 78.09714732062,84.8096427890786 76.884753327498,96.6462329091003 73.29416296937,107.554896839789 67.463360620072,117.116420743937 59.616420743937,124.963360620072 50.054896839789,130.79416296937 39.146232909101,134.384753327498 27.309642789079,135.59714732062 15))

query I
SELECT ST_ASTEXT(ST_GEOGFROMWKB('\x01\x06\x00\x00\x00\x03\x00\x00\x00\x01\x03\x00\x00\x00\x02\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10\xC0\x00\x00\x00\x00\x00\x00\x10\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x10@\x00\x00\x00\x00\x00\x00\x10@\x00\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00\x00\x00\x00\x00\xC0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xC0\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00\x00\x00\x00\x00\x00\x01\x03\x00\x00\x00\x02\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x008@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x004@\x00\x00\x00\x00\x00\x00\x10\xC0\x00\x00\x00\x00\x00\x000@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x004@\x00\x00\x00\x00\x00\x00\x10@\x00\x00\x00\x00\x00\x008@\x00\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x006@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x004@\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00\x00\x00\x002@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x004@\x00\x00\x00\x00\x00\x00\x00\xC0\x00\x00\x00\x00\x00\x006@\x00\x00\x00\x00\x00\x00\x00\x00\x01\x03\x00\x00\x00\x02\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00F@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00D@\x00\x00\x00\x00\x00\x00\x10\xC0\x00\x00\x00\x00\x00\x00B@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00D@\x00\x00\x00\x00\x00\x00\x10@\x00\x00\x00\x00\x00\x00F@\x00\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00E@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00D@\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00\x00\x00\x00C@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00D@\x00\x00\x00\x00\x00\x00\x00\xC0\x00\x00\x00\x00\x00\x00E@\x00\x00\x00\x00\x00\x00\x00\x00'::BLOB))
----
MULTIPOLYGON(((4 0,0 -4,-4 0,0 4,4 0),(2 0,0 2,-2 0,0 -2,2 0)),((24 0,20 -4,16 0,20 4,24 0),(22 0,20 2,18 0,20 -2,22 0)),((44 0,40 -4,36 0,40 4,44 0),(42 0,40 2,38 0,40 -2,42 0)))

query I
SELECT ST_ASTEXT(ST_GEOGFROMWKB('\x01\x07\x00\x00\x00\x04\x00\x00\x00\x01\x03\x00\x00\x00\x01\x00\x00\x00\x06\x00\x00\x00\x00\x00\x00\x00\x00\x80[\xC0\xA6\xAA\xAA\xAA\xAA\xAAE@\x00\x00\x00\x00\x00\x80[\xC0\x00\x00\x00\x00\x00\x80Q@\x00\x00\x00\x00\x00 Y@\x00\x00\x00\x00\x00\x80Q@@\x16\xB2\x90\x85\xACM@\x03\xF5\xA67\xBDi@@\xE6\xA2\x8B.\xBAhB@\x00\x00\x00\x00\x00\x80V@\x00\x00\x00\x00\x00\x80[\xC0\xA6\xAA\xAA\xAA\xAA\xAAE@\x01\x03\x00\x00\x00\x01\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00@`@\x00\x00\x00\x00\x00\xC0G@\x00\x00\x00\x00\x00@`@\xC3m\xDB\xB6m\xDBF\xC0\xE6\xA2\x8B.\xBAhB@\x00\x00\x00\x00\x00\x80V@@\x16\xB2\x90\x85\xACM@\x03\xF5\xA67\xBDi@@\x00\x00\x00\x00\x00@`@\x00\x00\x00\x00\x00\xC0G@\x01\x03\x00\x00\x00\x01\x00\x00\x00\x06\x00\x00\x00\x00\x00\x00\x00\x00@`@\xC3m\xDB\xB6m\xDBF\xC0\x00\x00\x00\x00\x00@`@\x00\x00\x00\x00\x00\x80V\xC0\x00\x00\x00\x00\x00\x80[\xC0\x00\x00\x00\x00\x00\x80V\xC0\x00\x00\x00\x00\x00\x80[\xC0\xA6\xAA\xAA\xAA\xAA\xAAE@\xE6\xA2\x8B.\xBAhB@\x00\x00\x00\x00\x00\x80V@\x00\x00\x00\x00\x00@`@\xC3m\xDB\xB6m\xDBF\xC0\x01\x03\x00\x00\x00\x01\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00 Y@\x00\x00\x00\x00\x00\x80Q@\x00\x00\x00\x00\x00@`@\x00\x00\x00\x00\x00\x80Q@\x00\x00\x00\x00\x00@`@\x00\x00\x00\x00\x00\xC0G@@\x16\xB2\x90\x85\xACM@\x03\xF5\xA67\xBDi@@\x00\x00\x00\x00\x00 Y@\x00\x00\x00\x00\x00\x80Q@'::BLOB))
----
GEOMETRYCOLLECTION(POLYGON((-110 43.3333333333333,-110 70,100.5 70,59.3478260869565 32.826086956522,36.8181818181818 90,-110 43.3333333333333)),POLYGON((130 47.5,130 -45.7142857142858,36.8181818181818 90,59.3478260869565 32.826086956522,130 47.5)),POLYGON((130 -45.7142857142858,130 -90,-110 -90,-110 43.3333333333333,36.8181818181818 90,130 -45.7142857142858)),POLYGON((100.5 70,130 70,130 47.5,59.3478260869565 32.826086956522,100.5 70)))

query I
SELECT ST_ASTEXT(ST_GEOGFROMWKB('\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x00\xF0?'::BLOB))
----
POINT(1 1)

query I
SELECT ST_ASTEXT(ST_GEOGFROMWKB('\x01\xEC\x03\x00\x00\x02\x00\x00\x00\x01\xE9\x03\x00\x00\x00\x00\x00\x00\x00\x00Y@\x00\x00\x00\x00\x00\x80V@\x00\x00\x00\x00\x00\x00>@\x01\xE9\x03\x00\x00\x00\x00\x00\x00\x00\x00I@\x00\x00\x00\x00\x00\x80R@\x00\x00\x00\x00\x00@\x8F@'::BLOB))
----
MULTIPOINT Z (100 90 30,50 74 1000)

statement error
SELECT ST_GEOGFROMWKB('aaa')

query I
SELECT ST_GEOGFROMWKB(NULL)
----
NULL

query I
SELECT ST_GEOGFROMWKB(''::BLOB)
----
(empty)

#test with invalid input
statement error
SELECT ST_GEOGFROMWKB(22)
