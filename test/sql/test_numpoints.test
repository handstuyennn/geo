# name: test/sql/test_numpoints.test
# description: ST_NUMPOINTS test
# group: [sql]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

#test with POINT
query I
SELECT ST_NUMPOINTS('POINT(30 10.2323)')
----
0

query I 
SELECT ST_NUMPOINTS('010100000000000000000024400000000000004B40')
----
0

query I 
SELECT ST_NUMPOINTS('{"type":"Point","coordinates":[-71.064544,10.2323]}')
----
0

#test with LINESTRING
query I
SELECT ST_NUMPOINTS('SRID=4326;LINESTRING(-72.1260 42.45, -72.1240 42.45666, -72.123 42.1546)')
----
3

query I 
SELECT ST_NUMPOINTS('010200000028000000d0ea37a29ac651c00fd603035b284540fefcfb379ac651c0c0503e9f5b284540ffdddd4d96c651c033ac3b284f2845402c7c643e8cc651c027d4465f58284540b03124ff85c651c0a206d8594928454017901c728fc651c08a98cca040284540b76e11dd93c651c063faf49536284540258f3b6b99c651c041cfb5203a284540db5ab4a09bc651c02189c9f731284540055bd8789cc651c0d6a3de703228454009a89e449dc651c0790a5d7f2f2845400dd1430b9ec651c0651ab8ab2c284540d24af36daac651c0451369ee3428454041db9a3faac651c00ad1f63636284540aabac10baac651c097b3f71438284540eea5f4e1a9c651c0bebe83fa39284540599a39c2a9c651c00c8c21e03b2845401ba199b1a9c651c03cfdd9c53d28454038b50baba9c651c01231a4ab3f2845408ad88faea9c651c08d27809141284540df0c26bca9c651c0a0e06d7743284540955cd7d8a9c651c0b13d765d452845408bc19affa9c651c0f75c9043472845400c397630aac651c07fd7422249284540eb5bc961aac651c0204b796b4a28454016701f8eaac651c04b0fb4a54b28454000417d0eacc651c04e95a723562845403648f5dba9c651c009a7d75754284540fd1f4f43a9c651c0d77c0c53562845404b7c9ca7a8c651c0c454e9d255284540debc3841a8c651c0a88c5cec57284540f633b6dca5c651c034c39ca855284540aaf53664a5c651c0da78aa37552845407c64fd2ca5c651c09de8f60255284540128f4caaa3c651c0f8e06cb753284540a5b22e7aa0c651c03263da775a284540ba48c02e9dc651c0b8ff45525728454079679ac79bc651c02b3b005b59284540882cec349bc651c04658452b5a284540d0ea37a29ac651c00fd603035b284540')
----
40

query I 
SELECT ST_NUMPOINTS('{"type":"LineString","coordinates":[[1,1],[2,2],[3,3],[4,4]]}')
----
4

#test with POLYGON
query I
SELECT ST_NUMPOINTS('POLYGON((-71.17166 42.353675,-71.172026 42.354044,-71.17239 42.354358,-71.171794 42.354971,-71.170511 42.354855,-71.17112 42.354238,-71.17166 42.353675))')
----
0

query I 
SELECT ST_NUMPOINTS('010300000001000000210000009f9eb2d41bf360400000000000002e4032d435e64fcc60402fb55b00da8505406ea475c8695960400000000000000000aa5d4db3a73d5f40fd1cf7917cfc534044f2fd6f73475d40ca0d02908c9851400ae3086e83e35a4081446599b0444f40e88b46e15b295840496e29de585a4c404f22fd2fd133554039af2867c08e4a400700000000205240a08535ad90f349407dbb05a05d184e402aaf2867c08e4a404de8723d482d48403b6e29de585a4c40073aee23f9b8424073446599b0444f402837084032e23b40bc0d02908c9851401e89ca3261093440ef1cf7917cfc534024b9a57863692c400000000000000000e2bca29c013b25402fb55b00da8505407916d6b442ce22400000000000002e40aabca29c013b25405a89f4bf444f3b40ebb8a57863692c407b178dc2b7924340ca88ca326109344015c611dc06074940f036084032e23b4088e4fbdfe6ce4d40cf39ee23f9b84240aa5d4db3a7dd504014e8723d482d4840dc48eb90d352524053bb05a05d184e4064a86bcc9f385340f2ffffffff1f52403e3d65a9378653403a22fd2fd133554064a86bcc9f385340d38b46e15b295840dc48eb90d35252400ae3086e83e35a40aa5d4db3a7dd504044f2fd6f73475d4088e4fbdfe6ce4d40aa5d4db3a73d5f4015c611dc060749406ea475c86959604008188dc2b792434032d435e64fcc60405a89f4bf444f3b409f9eb2d41bf360400000000000002e40')
----
0

query I 
SELECT ST_NUMPOINTS('POLYGON((0 0,0 50,150 50,150 0,0 0),(20 20,50 20,50 50,20 50,20 20))')
----
0

#test with MULTIPOINT
query I
SELECT ST_NUMPOINTS('MULTIPOINT(100 10 30, 50 74 1000)')
----
0

query I 
SELECT ST_NUMPOINTS('0104000000060000000101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f')
----
0

query I 
SELECT ST_NUMPOINTS('{"type":"MultiPoint","coordinates":[[35,14]]}')
----
0

#test with MULTILINESTRING
query I
SELECT ST_NUMPOINTS('MULTILINESTRING((-118.584 38.374 20,-118.583 38.5 30),(-71.05957 42.3589 75, -71.061 43 90))')
----
0

query I 
SELECT ST_NUMPOINTS('01050000C00200000001020000C004000000000000000000000000000000000000000000000000000000000000000000F03F00000000000000000000000000001440000000000000000000000000000000400000000000001440000000000000000000000000000000000000000000000840000000000000000000000000000000000000000000000000000000000000104001020000C004000000000000000000F03F000000000000F03F0000000000000000000000000000F03F0000000000000840000000000000F03F0000000000000000000000000000F03F000000000000F03F00000000000008400000000000000000000000000000F03F000000000000F03F000000000000F03F0000000000000000000000000000F03F')
----
0

query I 
SELECT ST_NUMPOINTS('{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237999999997]]]}')
----
0

#test with MULTIPOLYGON
query I
SELECT ST_NUMPOINTS('MULTIPOLYGON(((26 15,26 20,126 20,126 15,101 10,26 15),(51 10,101 10,76 15,51 10)),((151 10,151 20,176 15,151 10)))')
----
0

query I 
SELECT ST_NUMPOINTS('0106000000030000000103000000020000000500000000000000000010400000000000000000000000000000000000000000000010C000000000000010C00000000000000000000000000000000000000000000010400000000000001040000000000000000005000000000000000000004000000000000000000000000000000000000000000000004000000000000000C00000000000000000000000000000000000000000000000C0000000000000004000000000000000000103000000020000000500000000000000000038400000000000000000000000000000344000000000000010C000000000000030400000000000000000000000000000344000000000000010400000000000003840000000000000000005000000000000000000364000000000000000000000000000003440000000000000004000000000000032400000000000000000000000000000344000000000000000C0000000000000364000000000000000000103000000020000000500000000000000000046400000000000000000000000000000444000000000000010C000000000000042400000000000000000000000000000444000000000000010400000000000004640000000000000000005000000000000000000454000000000000000000000000000004440000000000000004000000000000043400000000000000000000000000000444000000000000000C000000000000045400000000000000000')
----
0

query I 
SELECT ST_NUMPOINTS('{"type":"MultiPolygon","coordinates":[[[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]],[[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,33]]]]}')
----
0

#test with COLLECTION
query I
SELECT ST_NUMPOINTS('GEOMETRYCOLLECTION(POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678)),LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932))')
----
0

query I 
SELECT ST_NUMPOINTS('010700000004000000010300000001000000060000000000000000805bc0a6aaaaaaaaaa45400000000000805bc00000000000805140000000000020594000000000008051404016b29085ac4d4003f5a637bd694040e6a28b2eba68424000000000008056400000000000805bc0a6aaaaaaaaaa45400103000000010000000500000000000000004060400000000000c047400000000000406040c36ddbb66ddb46c0e6a28b2eba68424000000000008056404016b29085ac4d4003f5a637bd69404000000000004060400000000000c04740010300000001000000060000000000000000406040c36ddbb66ddb46c0000000000040604000000000008056c00000000000805bc000000000008056c00000000000805bc0a6aaaaaaaaaa4540e6a28b2eba68424000000000008056400000000000406040c36ddbb66ddb46c001030000000100000005000000000000000020594000000000008051400000000000406040000000000080514000000000004060400000000000c047404016b29085ac4d4003f5a637bd69404000000000002059400000000000805140')
----
0

query I 
SELECT ST_NUMPOINTS('{"type":"GeometryCollection","geometries":[{"type":"MultiPoint","coordinates":[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]]},{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237999999997]]]},{"type":"MultiPolygon","coordinates":[[[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]],[[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,33]]]]}]}')
----
0

#test with NULL and empty value
query I
SELECT ST_NUMPOINTS('')
----
0

query I 
SELECT ST_NUMPOINTS(NULL)
----
NULL

# test with invalid input
statement error
SELECT ST_NUMPOINTS(22)

# test with table
statement ok
CREATE TABLE geographies (g Geography);

statement ok
INSERT INTO geographies VALUES('MULTIPOINT(0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9)'::GEOGRAPHY), ('010200000006000000e44a3d0b42ca51c06ec328081e21454027bf45274bca51c0f67b629d2a214540957cec2e50ca51c07099d3653121454047ded1e65dcb51c0781c510ef83145404871a7835dcb51c0ebdaee75f53145406285c7c15ecb51c0ed88fc0df5314540'), ('POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678))'::GEOGRAPHY), ('LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)'::GEOGRAPHY)

query R
SELECT ST_NUMPOINTS(g) FROM geographies
----
0
6
0
3

statement ok
INSERT INTO geographies VALUES(''::GEOGRAPHY), (NULL::GEOGRAPHY), ('LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932)')

query R
SELECT ST_NUMPOINTS(g) FROM geographies
----
0
6
0
3
0
NULL
3
