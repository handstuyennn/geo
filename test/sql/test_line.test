# name: test/sql/test_line.test
# description: LINE tests
# group: [sql]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE geographies (g Geography);

# Insert valid geometry strings
statement ok
INSERT INTO geographies VALUES('0102000000040000000000000000000040000000000000084000000000000010400000000000001440000000000000184000000000000014400000000000001C400000000000002040'), ('010200000004000000CB49287D21C451C0000000000000084000000000000010400000000000001440F0BF95ECD8A4454000000000000014400000000000001C40D8F0F44A59662040'), ('010200000004000000CB49287D21C451C0000000000000084000000000000012405917B7D1009E1640F0BF95ECD8A4454000000000000014400000000000001C40D8F0F44A59662040')

query T
SELECT * FROM geographies
----
0102000020E6100000040000000000000000000040000000000000084000000000000010400000000000001440000000000000184000000000000014400000000000001C400000000000002040
0102000020E610000004000000CB49287D21C451C0000000000000084000000000000010400000000000001440F0BF95ECD8A4454000000000000014400000000000001C40D8F0F44A59662040
0102000020E610000004000000CB49287D21C451C0000000000000084000000000000012405917B7D1009E1640F0BF95ECD8A4454000000000000014400000000000001C40D8F0F44A59662040

query T
SELECT ST_ASTEXT(g) FROM geographies
----
LINESTRING(2 3,4 5,6 5,7 8)
LINESTRING(-71.064544 3,4 5,43.28787 5,7 8.1999)
LINESTRING(-71.064544 3,4.5 5.6543,43.28787 5,7 8.1999)

statement error
INSERT INTO geographies(('0102000000040000000000000000000040000000000000084000000000000010400000000000001440000000000000184000000000000014400000000000001C4000000000000020409'))

# Insert valid strings with text
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES('LINESTRING(2 3,4 5,6 5,7 8)'), ('LINESTRING(-71.064544 3,4 5,43.28787 5,7 8.1999)'), ('LINESTRING(-71.064544 3,4.5 5.6543,43.28787 5,7 8.1999)')

query T
SELECT * FROM geographies
----
0102000020E6100000040000000000000000000040000000000000084000000000000010400000000000001440000000000000184000000000000014400000000000001C400000000000002040
0102000020E610000004000000CB49287D21C451C0000000000000084000000000000010400000000000001440F0BF95ECD8A4454000000000000014400000000000001C40D8F0F44A59662040
0102000020E610000004000000CB49287D21C451C0000000000000084000000000000012405917B7D1009E1640F0BF95ECD8A4454000000000000014400000000000001C40D8F0F44A59662040

query T
SELECT ST_ASTEXT(g) FROM geographies
----
LINESTRING(2 3,4 5,6 5,7 8)
LINESTRING(-71.064544 3,4 5,43.28787 5,7 8.1999)
LINESTRING(-71.064544 3,4.5 5.6543,43.28787 5,7 8.1999)

statement error
INSERT INTO geographies(('LINESTRING(-71.064544 42.28787)'))

# Insert valid strings with geojson
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES('{"type":"LineString","coordinates":[[1,2,3],[4,5,6]]}'), ('{"type":"LineString","coordinates":[[101.0,0.0],[102.0,1.0]]}'), ('{"type":"LineString","coordinates":[[42,42],[45,45]]}')

query T
SELECT * FROM geographies
----
01020000A0E610000002000000000000000000F03F00000000000000400000000000000840000000000000104000000000000014400000000000001840
0102000020E610000002000000000000000040594000000000000000000000000000805940000000000000F03F
0102000020E6100000020000000000000000004540000000000000454000000000008046400000000000804640

query T
SELECT ST_ASTEXT(g) FROM geographies
----
LINESTRING Z (1 2 3,4 5 6)
LINESTRING(101 0,102 1)
LINESTRING(42 42,45 45)

# Insert invalid geojson string
statement error
INSERT INTO geographies(('{"type":"LineString","coordinates":[30,10.2323]}'))
