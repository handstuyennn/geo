# name: test/sql/test_multiline.test
# description: MULTILINESTRING tests
# group: [sql]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE geographies (g Geography);

# Insert valid geometry strings
statement ok
INSERT INTO geographies VALUES('010500000002000000010200000002000000000000000000F03F0000000000000040000000000000084000000000000010400102000000020000000000000000000840000000000000104000000000000010400000000000001440'), ('01050000C00200000001020000C004000000000000000000000000000000000000000000000000000000000000000000F03F00000000000000000000000000001440000000000000000000000000000000400000000000001440000000000000000000000000000000000000000000000840000000000000000000000000000000000000000000000000000000000000104001020000C004000000000000000000F03F000000000000F03F0000000000000000000000000000F03F0000000000000840000000000000F03F0000000000000000000000000000F03F000000000000F03F00000000000008400000000000000000000000000000F03F000000000000F03F000000000000F03F0000000000000000000000000000F03F'), ('0105000000020000000102000000040000000000000000003DC00000000000003BC00000000000003EC03333333333B33DC000000000000042C00000000000003FC000000000008046C000000000008040C001020000000200000000000000008046C000000000008040C000000000000047C000000000000040C0'), ('0105000000020000000102000000040000000000000000003DC00000000000003BC00000000000003EC03333333333B33DC000000000000042C00000000000003FC000000000008046C000000000008040C001020000000200000000000000008046C000000000008040C000000000000047C000000000000040C0')

query T
SELECT * FROM geographies
----
0105000020E610000002000000010200000002000000000000000000F03F0000000000000040000000000000084000000000000010400102000000020000000000000000000840000000000000104000000000000010400000000000001440
01050000E0E61000000200000001020000C004000000000000000000000000000000000000000000000000000000000000000000F03F00000000000000000000000000001440000000000000000000000000000000400000000000001440000000000000000000000000000000000000000000000840000000000000000000000000000000000000000000000000000000000000104001020000C004000000000000000000F03F000000000000F03F0000000000000000000000000000F03F0000000000000840000000000000F03F0000000000000000000000000000F03F000000000000F03F00000000000008400000000000000000000000000000F03F000000000000F03F000000000000F03F0000000000000000000000000000F03F
0105000020E6100000020000000102000000040000000000000000003DC00000000000003BC00000000000003EC03333333333B33DC000000000000042C00000000000003FC000000000008046C000000000008040C001020000000200000000000000008046C000000000008040C000000000000047C000000000000040C0
0105000020E6100000020000000102000000040000000000000000003DC00000000000003BC00000000000003EC03333333333B33DC000000000000042C00000000000003FC000000000008046C000000000008040C001020000000200000000000000008046C000000000008040C000000000000047C000000000000040C0

query T
SELECT ST_ASTEXT(g) FROM geographies
----
MULTILINESTRING((1 2,3 4),(3 4,4 5))
MULTILINESTRING ZM ((0 0 0 1,0 5 0 2,5 0 0 3,0 0 0 4),(1 1 0 1,3 1 0 1,1 3 0 1,1 1 0 1))
MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45 -33,-46 -32))
MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45 -33,-46 -32))

statement error
INSERT INTO geographies(('010500000002000000010200000002000000000000000000F03F000000000000004000000000000008400000000000001040010200000002000000000000000000084000000000000010400000000000001040000000000000144022'))

# Insert valid strings with text
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES('MULTILINESTRING((1 2,3 4),(3 4,4 5))'), ('MULTILINESTRING((0 0 0 1,0 5 0 2,5 0 0 3,0 0 0 4),(1 1 0 1,3 1 0 1,1 3 0 1,1 1 0 1))'), ('MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45 -33,-46 -32))')

query T
SELECT * FROM geographies
----
0105000020E610000002000000010200000002000000000000000000F03F0000000000000040000000000000084000000000000010400102000000020000000000000000000840000000000000104000000000000010400000000000001440
01050000E0E61000000200000001020000C004000000000000000000000000000000000000000000000000000000000000000000F03F00000000000000000000000000001440000000000000000000000000000000400000000000001440000000000000000000000000000000000000000000000840000000000000000000000000000000000000000000000000000000000000104001020000C004000000000000000000F03F000000000000F03F0000000000000000000000000000F03F0000000000000840000000000000F03F0000000000000000000000000000F03F000000000000F03F00000000000008400000000000000000000000000000F03F000000000000F03F000000000000F03F0000000000000000000000000000F03F
0105000020E6100000020000000102000000040000000000000000003DC00000000000003BC00000000000003EC03333333333B33DC000000000000042C00000000000003FC000000000008046C000000000008040C001020000000200000000000000008046C000000000008040C000000000000047C000000000000040C0

query T
SELECT ST_ASTEXT(g) FROM geographies
----
MULTILINESTRING((1 2,3 4),(3 4,4 5))
MULTILINESTRING ZM ((0 0 0 1,0 5 0 2,5 0 0 3,0 0 0 4),(1 1 0 1,3 1 0 1,1 3 0 1,1 1 0 1))
MULTILINESTRING((-29 -27,-30 -29.7,-36 -31,-45 -33),(-45 -33,-46 -32))

statement error
INSERT INTO geographies(('MULTILINESTRING(-71.064544 42.28787)'))

# Insert valid strings with geojson
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES('{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237999999997]]]}'), ('{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.1001,31.22]],[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237]]]}'), ('{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.1001,31.22]],[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237]],[[-100.734634999999997,44.492072000000000],[-89.1001,31.22]]]}')

query T
SELECT * FROM geographies
----
0105000020E610000001000000010200000002000000CEDF8442046F56C0FE463B6EF87D3F40EFFFE384096F56C033D93F4F037E3F40
0105000020E610000002000000010200000002000000CEDF8442046F56C0FE463B6EF87D3F401895D409684656C0B81E85EB51383F40010200000002000000CEDF8442046F56C0FE463B6EF87D3F40EFFFE384096F56C093E1783E037E3F40
0105000020E610000003000000010200000002000000CEDF8442046F56C0FE463B6EF87D3F401895D409684656C0B81E85EB51383F40010200000002000000CEDF8442046F56C0FE463B6EF87D3F40EFFFE384096F56C093E1783E037E3F40010200000002000000CEDF8442042F59C07FA31D37FC3E46401895D409684656C0B81E85EB51383F40

query T
SELECT ST_ASTEXT(g) FROM geographies
----
MULTILINESTRING((-89.734635 31.492072,-89.734956 31.492237999999997))
MULTILINESTRING((-89.734635 31.492072,-89.1001 31.22),(-89.734635 31.492072,-89.734956 31.492237))
MULTILINESTRING((-89.734635 31.492072,-89.1001 31.22),(-89.734635 31.492072,-89.734956 31.492237),(-100.734635 44.492072,-89.1001 31.22))

# Insert invalid geojson string
statement error
INSERT INTO geographies(('{"type":"MultiLineString","coordinates":[[30,10.2323]}'))
