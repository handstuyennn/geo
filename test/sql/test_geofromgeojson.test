# name: test/sql/function/test_geofromgeojson.test
# description: ST_GEOMFROMGEOJSON/ST_GEOGFROMGEOJSON test
# group: [function]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE geographies(g Geography)

statement ok
INSERT INTO geographies VALUES(ST_GEOGFROMGEOJSON('{"type":"Point","coordinates":[-71.064544,10.2323]}')), (ST_GEOMFROMGEOJSON('{"type":"Polygon","coordinates":[[[0,0],[0,150],[150,150],[150,0],[0,0]],[[20,20],[50,20],[50,50],[20,50],[20,20]]]}')),(ST_GEOMFROMGEOJSON(NULL))

query R
select ST_ASTEXT(g) from geographies
----
POINT(-71.064544 10.2323)
POLYGON((0 0,0 150,150 150,150 0,0 0),(20 20,50 20,50 50,20 50,20 20))
NULL

# test with null and empty
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES(ST_GEOGFROMGEOJSON('')), (ST_GEOGFROMGEOJSON(NULL))

query R
select ST_ASTEXT(g) from geographies
----
(empty)
NULL

query I
SELECT ST_GEOGFROMGEOJSON('{"type": "Point", "coordinates": [42, 42]}')
----
0101000020E610000000000000000045400000000000004540

query I
SELECT ST_GEOGFROMGEOJSON('{"type":"MultiPoint","coordinates":[[35,14]]}')
----
0104000020E610000001000000010100000000000000008041400000000000002C40

query I
SELECT ST_GEOGFROMGEOJSON('{"type":"LineString","coordinates":[[1,1],[2,2],[3,3],[4,4]]}')
----
0102000020E610000004000000000000000000F03F000000000000F03F000000000000004000000000000000400000000000000840000000000000084000000000000010400000000000001040

query I
SELECT ST_GEOGFROMGEOJSON('{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237999999997]]]}')
----
0105000020E610000001000000010200000002000000CEDF8442046F56C0FE463B6EF87D3F40EFFFE384096F56C033D93F4F037E3F40

query I
SELECT ST_GEOGFROMGEOJSON('{"type":"Polygon","coordinates":[[[0,0],[0,150],[150,150],[150,0],[0,0]],[[20,20],[50,20],[50,50],[20,50],[20,20]]]}')
----
0103000020E610000002000000050000000000000000000000000000000000000000000000000000000000000000C062400000000000C062400000000000C062400000000000C06240000000000000000000000000000000000000000000000000050000000000000000003440000000000000344000000000000049400000000000003440000000000000494000000000000049400000000000003440000000000000494000000000000034400000000000003440

query I
SELECT ST_GEOGFROMGEOJSON('{"type":"MultiPolygon","coordinates":[[[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]],[[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,33]]]]}')
----
0106000020E6100000010000000103000000020000002B0000000000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC00000000000004040070000000000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000000040400000000000405DC00000000000804040

query I
SELECT ST_GEOGFROMGEOJSON('{"type":"GeometryCollection","geometries":[{"type":"MultiPoint","coordinates":[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]]},{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237999999997]]]},{"type":"MultiPolygon","coordinates":[[[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]],[[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,33]]]]}]}')
----
0107000020E61000000300000001040000002B00000001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC00000000000004040010500000001000000010200000002000000CEDF8442046F56C0FE463B6EF87D3F40EFFFE384096F56C033D93F4F037E3F400106000000010000000103000000020000002B0000000000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC00000000000004040070000000000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000000040400000000000405DC00000000000804040

statement error
SELECT ST_GEOGFROMGEOJSON('aaa')

query I
SELECT ST_GEOGFROMGEOJSON(NULL)
----
NULL

query I
SELECT ST_GEOGFROMGEOJSON('')
----
(empty)

#test with invalid input
statement error
SELECT ST_GEOGFROMGEOJSON(22)
