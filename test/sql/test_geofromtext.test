# name: test/sql/function/test_geofromtext.test
# description: ST_GEOMFROMTEXT/ST_GEOGFROMTEXT test
# group: [function]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE geographies(g Geography)

statement ok
INSERT INTO geographies VALUES(ST_GEOMFROMTEXT('MULTIPOINT(0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9)')), (ST_GEOGFROMTEXT('POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678))')),(ST_GEOGFROMTEXT(NULL))

query R
select ST_ASGEOJSON(g) from geographies
----
{"type":"MultiPoint","coordinates":[[0.9,0.9],[0.9,0.9],[0.9,0.9],[0.9,0.9],[0.9,0.9],[0.9,0.9]]}
{"type":"Polygon","coordinates":[[[-71.040878,42.285678],[-71.040943,42.2856],[-71.04096,42.285752],[-71.040878,42.285678]]]}
NULL

# test with null and empty
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES(''), (NULL)

query R
select ST_ASGEOJSON(g) from geographies
----
(empty)
NULL

query I
SELECT ST_GEOGFROMTEXT('POINT(1 1)')
----
0101000020E6100000000000000000F03F000000000000F03F

query I
SELECT ST_GEOGFROMTEXT('MULTIPOINT(100 10 30, 50 74 1000)')
----
01040000A0E6100000020000000101000080000000000000594000000000000024400000000000003E400101000080000000000000494000000000008052400000000000408F40

query I
SELECT ST_GEOGFROMTEXT('SRID=4326;LINESTRING(-72.1260 42.45, -72.1240 42.45666, -72.123 42.1546)')
----
0102000020E610000003000000F2D24D62100852C09A999999993945400E2DB29DEF0752C018B2BAD5733A45401D5A643BDF0752C016FBCBEEC9134540

query I
SELECT ST_GEOGFROMTEXT('MULTILINESTRING((-118.584 38.374 20,-118.583 38.5 30),(-71.05957 42.3589 75, -71.061 43 90))')
----
01050000A0E6100000020000000102000080020000004C37894160A55DC01D5A643BDF2F434000000000000034405A643BDF4FA55DC000000000004043400000000000003E40010200008002000000A774B0FECFC351C06744696FF02D45400000000000C0524096438B6CE7C351C000000000008045400000000000805640

query I
SELECT ST_GEOGFROMTEXT('MULTILINESTRING((-118.584 38.374 20,-118.583 38.5 30),(-71.05957 42.3589 75, -71.061 43 90))')
----
01050000A0E6100000020000000102000080020000004C37894160A55DC01D5A643BDF2F434000000000000034405A643BDF4FA55DC000000000004043400000000000003E40010200008002000000A774B0FECFC351C06744696FF02D45400000000000C0524096438B6CE7C351C000000000008045400000000000805640

query I
SELECT ST_GEOGFROMTEXT('POLYGON((-71.17166 42.353675,-71.172026 42.354044,-71.17239 42.354358,-71.171794 42.354971,-71.170511 42.354855,-71.17112 42.354238,-71.17166 42.353675))')
----
0103000020E610000001000000070000000282397AFCCA51C0D734EF38452D4540F303577902CB51C02AAC5450512D4540130A117008CB51C0B9895A9A5B2D45408AE942ACFECA51C0A30392B06F2D4540EE26F8A6E9CA51C03AE97DE36B2D454042EC4CA1F3CA51C00F80B8AB572D45400282397AFCCA51C0D734EF38452D4540

query I
SELECT ST_GEOGFROMTEXT('MULTIPOLYGON(((26 12.5,26 20.0,126 20.0,126 12.5,101 10.0,26 12.5),(51 15.0,101 15.0,76 17.5,51 15.0)),((151 10.0,151 20.0,176 17.5,151 10.0)))')
----
0106000020E610000002000000010300000002000000060000000000000000003A4000000000000029400000000000003A4000000000000034400000000000805F4000000000000034400000000000805F400000000000002940000000000040594000000000000024400000000000003A4000000000000029400400000000000000008049400000000000002E4000000000004059400000000000002E400000000000005340000000000080314000000000008049400000000000002E40010300000001000000040000000000000000E0624000000000000024400000000000E062400000000000003440000000000000664000000000008031400000000000E062400000000000002440

query I
SELECT ST_GEOGFROMTEXT('GEOMETRYCOLLECTION(POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678)),LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932))')
----
0107000020E610000002000000010300000001000000040000000F48C2BE9DC251C0E597C11891244540028063CF9EC251C06ADE718A8E2445406D1CB1169FC251C020628385932445400F48C2BE9DC251C0E597C11891244540010200000003000000E44A3D0B42CA51C06EC328081E21454027BF45274BCA51C0F67B629D2A214540957CEC2E50CA51C07099D36531214540

query I
SELECT ST_GEOGFROMTEXT('GEOMETRYCOLLECTION(POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678)),LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932))')
----
0107000020E610000002000000010300000001000000040000000F48C2BE9DC251C0E597C11891244540028063CF9EC251C06ADE718A8E2445406D1CB1169FC251C020628385932445400F48C2BE9DC251C0E597C11891244540010200000003000000E44A3D0B42CA51C06EC328081E21454027BF45274BCA51C0F67B629D2A214540957CEC2E50CA51C07099D36531214540

statement error
SELECT ST_GEOGFROMTEXT('aaa')

query I
SELECT ST_GEOGFROMTEXT(NULL)
----
NULL

query I
SELECT ST_GEOGFROMTEXT('')
----
(empty)

#test with invalid input
statement error
SELECT ST_GEOGFROMTEXT(22)
