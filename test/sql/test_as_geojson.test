# name: test/sql/function/test_as_geojson.test
# description: ST_ASGEOJSON test
# group: [function]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE geographies(g Geography)

statement ok
INSERT INTO geographies VALUES('0101000000295C8FC2F5281440E17A14AE47E12540'), ('{"type":"Point","coordinates":[-71.064544,10.2323]}'), ('POLYGON((0 0,0 50,150 50,150 0,0 0),(20 20,50 20,50 50,20 50,20 20))'), (NULL)

query R
select ST_ASGEOJSON(g) from geographies
----
{"type":"Point","coordinates":[5.04,10.94]}
{"type":"Point","coordinates":[-71.064544,10.2323]}
{"type":"Polygon","coordinates":[[[0,0],[0,50],[150,50],[150,0],[0,0]],[[20,20],[50,20],[50,50],[20,50],[20,20]]]}
NULL

# test with null and empty
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES(''), (NULL)

query R
select ST_ASGEOJSON(g) from geographies
----
(empty)
NULL

query I
SELECT ST_ASGEOJSON(ST_MAKEPOINT(5.04, 10.94))
----
{"type":"Point","coordinates":[5.04,10.94]}

query I
SELECT ST_ASGEOJSON('0101000000295C8FC2F5281440E17A14AE47E12540')
----
{"type":"Point","coordinates":[5.04,10.94]}

query I
SELECT ST_ASGEOJSON('010400000004000000010100000000000000000034400000000000003440010100000000000000000034400000000000003e4001010000000000000000003e400000000000003440010100000000000000008066400000000000805640')
----
{"type":"MultiPoint","coordinates":[[20,20],[20,30],[30,20],[180,90]]}

query I
SELECT ST_ASGEOJSON('01020000000100000000000000000041400000000000003540')
----
{"type":"LineString","coordinates":[[34,21]]}

query I
SELECT ST_ASGEOJSON('0105000000020000000102000000080000000000000000806440000000000000f03f0000000000003240000000000000f03fb420dec1fd8428403c6e02b76b220140e46fd1ffd6921d40e46fd1ffd6921540e46fd1ffd6921540e46fd1ffd6921d40f86d02b76b220140b420dec1fd842840000000000000f03f0000000000003240000000000000f03f000000000080564001020000000700000000000000008064400000000000003f4000000000000047400000000000003f401f8877703f214440e42670bb26124040fe2dfadf5ab24140fe2dfadf5ab24140e42670bb261240402d8877703f2144400000000000003f4000000000000047400000000000003f400000000000805640')
----
{"type":"MultiLineString","coordinates":[[[164,1],[18,1],[12.2597485145237,2.1418070123307],[7.39339828220179,5.39339828220179],[5.39339828220179,7.39339828220179],[2.14180701233067,12.2597485145237],[1,18],[1,90]],[[164,31],[46,31],[40.2597485145236,32.1418070123307],[35.3933982822018,35.3933982822018],[32.1418070123307,40.2597485145237],[31,46],[31,90]]]}

query I
SELECT ST_ASGEOJSON('0103000000020000000500000000000000000000000000000000000000000000000000000000000000000049400000000000c0624000000000000049400000000000c06240000000000000000000000000000000000000000000000000050000000000000000003440000000000000344000000000000049400000000000003440000000000000494000000000000049400000000000003440000000000000494000000000000034400000000000003440')
----
{"type":"Polygon","coordinates":[[[0,0],[0,50],[150,50],[150,0],[0,0]],[[20,20],[50,20],[50,50],[20,50],[20,20]]]}

query I
SELECT ST_ASGEOJSON('010700000003000000010200000004000000ec51b81e85eb074000000000008056400000000000c0514000000000008052400000000000003440000000000000244000000000006065400000000000002c400101000000ec51b81e85eb0740000000000080564001030000000100000004000000c3f5285c8fea6340e17a14ae47612b4000000000006065400000000000002c4052b81e85eb296440295c8fc2f5a82840c3f5285c8fea6340e17a14ae47612b40')
----
{"type":"GeometryCollection","geometries":[{"type":"LineString","coordinates":[[2.99,90],[71,74],[20,10],[171,14]]},{"type":"Point","coordinates":[2.99,90]},{"type":"Polygon","coordinates":[[[159.33,13.69],[171,14],[161.31,12.33],[159.33,13.69]]]}]}

statement error
SELECT ST_ASGEOJSON('aaa')

query I
SELECT ST_ASGEOJSON(NULL)
----
NULL

query I
SELECT ST_ASGEOJSON('')
----
(empty)

#test with invalid input
statement error
SELECT ST_ASGEOJSON(22)
