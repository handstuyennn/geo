# name: test/sql/function/test_geogfrom.test
# description: ST_GEOMFROM test
# group: [function]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE geographies(g Geography)

statement ok
INSERT INTO geographies VALUES(ST_GEOGFROM('0101000000295C8FC2F5281440E17A14AE47E12540')), (ST_GEOGFROM('{"type":"Point","coordinates":[-71.064544,10.2323]}')), (ST_GEOGFROM('POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678))')),(ST_GEOGFROM(NULL))

query R
select ST_ASTEXT(g) from geographies
----
POINT(5.04 10.94)
POINT(-71.064544 10.2323)
POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678))
NULL

# test with null and empty
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES(''), (NULL)

query R
select ST_ASTEXT(g) from geographies
----
(empty)
NULL

query I
SELECT ST_GEOGFROM('POINT(1 1)')
----
0101000020E6100000000000000000F03F000000000000F03F

query I
SELECT ST_GEOGFROM('{"type": "Point", "coordinates": [42, 42]}')
----
0101000020E610000000000000000045400000000000004540

query I
SELECT ST_ASTEXT(ST_GEOGFROM('0101000020E6100000000000000000F03F000000000000F03F'))
----
POINT(1 1)

query I
SELECT ST_GEOGFROM('MULTIPOINT(100 90 30, 50 74 90)')
----
01040000A0E6100000020000000101000080000000000000594000000000008056400000000000003E400101000080000000000000494000000000008052400000000000805640

query I
SELECT ST_GEOGFROM('{"type":"MultiPoint","coordinates":[[35,14]]}')
----
0104000020E610000001000000010100000000000000008041400000000000002C40

query I
SELECT ST_ASTEXT(ST_GEOGFROM('0104000000060000000101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f'))
----
MULTIPOINT(0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9,0.9 0.9)

query I
SELECT ST_GEOGFROM('SRID=4326;LINESTRING(-72.1260 42.45, -72.1240 42.45666, -72.123 42.1546)')
----
0102000020E610000003000000F2D24D62100852C09A999999993945400E2DB29DEF0752C018B2BAD5733A45401D5A643BDF0752C016FBCBEEC9134540

query I
SELECT ST_GEOGFROM('{"type":"LineString","coordinates":[[1,1],[2,2],[3,3],[4,4]]}')
----
0102000020E610000004000000000000000000F03F000000000000F03F000000000000004000000000000000400000000000000840000000000000084000000000000010400000000000001040

query I
SELECT ST_ASTEXT(ST_GEOGFROM('010200000006000000e44a3d0b42ca51c06ec328081e21454027bf45274bca51c0f67b629d2a214540957cec2e50ca51c07099d3653121454047ded1e65dcb51c0781c510ef83145404871a7835dcb51c0ebdaee75f53145406285c7c15ecb51c0ed88fc0df5314540'))
----
LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932,-71.1776063012595 42.3903825660754,-71.1775826583081 42.3903033653531,-71.1776585052917 42.3902909739571)

query I
SELECT ST_GEOGFROM('MULTILINESTRING((-118.584 38.374 20,-118.583 38.5 30),(-71.05957 42.3589 75, -71.061 43 90))')
----
01050000A0E6100000020000000102000080020000004C37894160A55DC01D5A643BDF2F434000000000000034405A643BDF4FA55DC000000000004043400000000000003E40010200008002000000A774B0FECFC351C06744696FF02D45400000000000C0524096438B6CE7C351C000000000008045400000000000805640

query I
SELECT ST_GEOGFROM('{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237999999997]]]}')
----
0105000020E610000001000000010200000002000000CEDF8442046F56C0FE463B6EF87D3F40EFFFE384096F56C033D93F4F037E3F40

query I
SELECT ST_ASTEXT(ST_GEOGFROM('01050000C00200000001020000C004000000000000000000000000000000000000000000000000000000000000000000F03F00000000000000000000000000001440000000000000000000000000000000400000000000001440000000000000000000000000000000000000000000000840000000000000000000000000000000000000000000000000000000000000104001020000C004000000000000000000F03F000000000000F03F0000000000000000000000000000F03F0000000000000840000000000000F03F0000000000000000000000000000F03F000000000000F03F00000000000008400000000000000000000000000000F03F000000000000F03F000000000000F03F0000000000000000000000000000F03F'))
----
MULTILINESTRING ZM ((0 0 0 1,0 5 0 2,5 0 0 3,0 0 0 4),(1 1 0 1,3 1 0 1,1 3 0 1,1 1 0 1))

query I
SELECT ST_GEOGFROM('POLYGON((-71.17166 42.353675,-71.172026 42.354044,-71.17239 42.354358,-71.171794 42.354971,-71.170511 42.354855,-71.17112 42.354238,-71.17166 42.353675))')
----
0103000020E610000001000000070000000282397AFCCA51C0D734EF38452D4540F303577902CB51C02AAC5450512D4540130A117008CB51C0B9895A9A5B2D45408AE942ACFECA51C0A30392B06F2D4540EE26F8A6E9CA51C03AE97DE36B2D454042EC4CA1F3CA51C00F80B8AB572D45400282397AFCCA51C0D734EF38452D4540

query I
SELECT ST_GEOGFROM('{"type":"Polygon","coordinates":[[[0,0],[0,15],[15,15],[15,0],[0,0]],[[2,2],[5,2],[5,5],[2,5],[2,2]]]}')
----
0103000020E610000002000000050000000000000000000000000000000000000000000000000000000000000000002E400000000000002E400000000000002E400000000000002E40000000000000000000000000000000000000000000000000050000000000000000000040000000000000004000000000000014400000000000000040000000000000144000000000000014400000000000000040000000000000144000000000000000400000000000000040

query I
SELECT ST_ASTEXT(ST_GEOGFROM('010700000004000000010300000001000000060000000000000000805bc0a6aaaaaaaaaa45400000000000805bc00000000000805140000000000020594000000000008051404016b29085ac4d4003f5a637bd694040e6a28b2eba68424000000000008056400000000000805bc0a6aaaaaaaaaa45400103000000010000000500000000000000004060400000000000c047400000000000406040c36ddbb66ddb46c0e6a28b2eba68424000000000008056404016b29085ac4d4003f5a637bd69404000000000004060400000000000c04740010300000001000000060000000000000000406040c36ddbb66ddb46c0000000000040604000000000008056c00000000000805bc000000000008056c00000000000805bc0a6aaaaaaaaaa4540e6a28b2eba68424000000000008056400000000000406040c36ddbb66ddb46c001030000000100000005000000000000000020594000000000008051400000000000406040000000000080514000000000004060400000000000c047404016b29085ac4d4003f5a637bd69404000000000002059400000000000805140'))
----
GEOMETRYCOLLECTION(POLYGON((-110 43.3333333333333,-110 70,100.5 70,59.3478260869565 32.826086956522,36.8181818181818 90,-110 43.3333333333333)),POLYGON((130 47.5,130 -45.7142857142858,36.8181818181818 90,59.3478260869565 32.826086956522,130 47.5)),POLYGON((130 -45.7142857142858,130 -90,-110 -90,-110 43.3333333333333,36.8181818181818 90,130 -45.7142857142858)),POLYGON((100.5 70,130 70,130 47.5,59.3478260869565 32.826086956522,100.5 70)))

query I
SELECT ST_GEOGFROM('MULTIPOLYGON(((26 12.5,26 20.0,126 20.0,126 12.5,101 10.0,26 12.5),(51 15.0,101 15.0,76 17.5,51 15.0)),((151 10.0,151 20.0,176 17.5,151 10.0)))')
----
0106000020E610000002000000010300000002000000060000000000000000003A4000000000000029400000000000003A4000000000000034400000000000805F4000000000000034400000000000805F400000000000002940000000000040594000000000000024400000000000003A4000000000000029400400000000000000008049400000000000002E4000000000004059400000000000002E400000000000005340000000000080314000000000008049400000000000002E40010300000001000000040000000000000000E0624000000000000024400000000000E062400000000000003440000000000000664000000000008031400000000000E062400000000000002440

query I
SELECT ST_GEOGFROM('{"type":"MultiPolygon","coordinates":[[[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]],[[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,33]]]]}')
----
0106000020E6100000010000000103000000020000002B0000000000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC00000000000004040070000000000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000000040400000000000405DC00000000000804040

query I
SELECT ST_ASTEXT(ST_GEOGFROM('0106000000030000000103000000020000000500000000000000000010400000000000000000000000000000000000000000000010C000000000000010C00000000000000000000000000000000000000000000010400000000000001040000000000000000005000000000000000000004000000000000000000000000000000000000000000000004000000000000000C00000000000000000000000000000000000000000000000C0000000000000004000000000000000000103000000020000000500000000000000000038400000000000000000000000000000344000000000000010C000000000000030400000000000000000000000000000344000000000000010400000000000003840000000000000000005000000000000000000364000000000000000000000000000003440000000000000004000000000000032400000000000000000000000000000344000000000000000C0000000000000364000000000000000000103000000020000000500000000000000000046400000000000000000000000000000444000000000000010C000000000000042400000000000000000000000000000444000000000000010400000000000004640000000000000000005000000000000000000454000000000000000000000000000004440000000000000004000000000000043400000000000000000000000000000444000000000000000C000000000000045400000000000000000'))
----
MULTIPOLYGON(((4 0,0 -4,-4 0,0 4,4 0),(2 0,0 2,-2 0,0 -2,2 0)),((24 0,20 -4,16 0,20 4,24 0),(22 0,20 2,18 0,20 -2,22 0)),((44 0,40 -4,36 0,40 4,44 0),(42 0,40 2,38 0,40 -2,42 0)))

query I
SELECT ST_GEOGFROM('GEOMETRYCOLLECTION(POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678)),LINESTRING(-71.160281 42.258729,-71.160837 42.259113,-71.161144 42.25932))')
----
0107000020E610000002000000010300000001000000040000000F48C2BE9DC251C0E597C11891244540028063CF9EC251C06ADE718A8E2445406D1CB1169FC251C020628385932445400F48C2BE9DC251C0E597C11891244540010200000003000000E44A3D0B42CA51C06EC328081E21454027BF45274BCA51C0F67B629D2A214540957CEC2E50CA51C07099D36531214540

query I
SELECT ST_GEOGFROM('{"type":"GeometryCollection","geometries":[{"type":"MultiPoint","coordinates":[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]]},{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237999999997]]]},{"type":"MultiPolygon","coordinates":[[[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]],[[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,33]]]]}]}')
----
0107000020E61000000300000001040000002B00000001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000080404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000005DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC0000000000000404001010000000000000000405DC00000000000004040010500000001000000010200000002000000CEDF8442046F56C0FE463B6EF87D3F40EFFFE384096F56C033D93F4F037E3F400106000000010000000103000000020000002B0000000000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000005DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC000000000000040400000000000405DC00000000000004040070000000000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000008040400000000000405DC000000000000040400000000000405DC00000000000804040

query I
SELECT ST_ASTEXT(ST_GEOGFROM('010700000004000000010300000001000000060000000000000000805bc0a6aaaaaaaaaa45400000000000805bc00000000000805140000000000020594000000000008051404016b29085ac4d4003f5a637bd694040e6a28b2eba68424000000000008056400000000000805bc0a6aaaaaaaaaa45400103000000010000000500000000000000004060400000000000c047400000000000406040c36ddbb66ddb46c0e6a28b2eba68424000000000008056404016b29085ac4d4003f5a637bd69404000000000004060400000000000c04740010300000001000000060000000000000000406040c36ddbb66ddb46c0000000000040604000000000008056c00000000000805bc000000000008056c00000000000805bc0a6aaaaaaaaaa4540e6a28b2eba68424000000000008056400000000000406040c36ddbb66ddb46c001030000000100000005000000000000000020594000000000008051400000000000406040000000000080514000000000004060400000000000c047404016b29085ac4d4003f5a637bd69404000000000002059400000000000805140'))
----
GEOMETRYCOLLECTION(POLYGON((-110 43.3333333333333,-110 70,100.5 70,59.3478260869565 32.826086956522,36.8181818181818 90,-110 43.3333333333333)),POLYGON((130 47.5,130 -45.7142857142858,36.8181818181818 90,59.3478260869565 32.826086956522,130 47.5)),POLYGON((130 -45.7142857142858,130 -90,-110 -90,-110 43.3333333333333,36.8181818181818 90,130 -45.7142857142858)),POLYGON((100.5 70,130 70,130 47.5,59.3478260869565 32.826086956522,100.5 70)))

statement error
SELECT ST_GEOGFROM('aaa')

query I
SELECT ST_GEOGFROM(NULL)
----
NULL

query I
SELECT ST_GEOGFROM('')
----
(empty)

#test with invalid input
statement error
SELECT ST_GEOGFROM(22)
