# name: test/sql/function/test_as_binary.test
# description: ST_ASBINARY test
# group: [function]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE geographies(g Geography)

statement ok
INSERT INTO geographies VALUES('{"type":"Point","coordinates":[30,10.2323]}'), ('{"type":"Point","coordinates":[-71.064544,10.2323]}'), ('{"type":"Point","coordinates":[30,43.28787]}')

query R
select ST_ASBINARY(g)::VARCHAR from geographies
----
\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00>@\xBB\xB8\x8D\x06\xF0v$@
\x01\x01\x00\x00\x00\xCBI(}!\xC4Q\xC0\xBB\xB8\x8D\x06\xF0v$@
\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00>@\xF0\xBF\x95\xEC\xD8\xA4E@

# test with null and empty
statement ok
DELETE FROM geographies

statement ok
INSERT INTO geographies VALUES(''), (NULL)

query R
select ST_ASBINARY(g) from geographies
----
(empty)
NULL

query I
SELECT ST_ASBINARY(ST_MAKEPOINT(5.04, 10.94))
----
\x01\x01\x00\x00\x00)\x5C\x8F\xC2\xF5(\x14@\xE1z\x14\xAEG\xE1%@

query I
SELECT ST_ASBINARY('MULTIPOINT((20 20), (20 30), (30 20), (180 90))'::GEOGRAPHY)
----
\x01\x04\x00\x00\x00\x04\x00\x00\x00\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x004@\x00\x00\x00\x00\x00\x004@\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x004@\x00\x00\x00\x00\x00\x00>@\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00>@\x00\x00\x00\x00\x00\x004@\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x80f@\x00\x00\x00\x00\x00\x80V@

query I
SELECT ST_ASBINARY(ST_MAKELINE('POINT EMPTY', 'POINT(34 21)'))
----
\x01\x02\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00A@\x00\x00\x00\x00\x00\x005@

query I
SELECT ST_ASBINARY('MULTILINESTRING((164 1,18 1,12.2597485145237 2.1418070123307,7.39339828220179 5.39339828220179,5.39339828220179 7.39339828220179,2.14180701233067 12.2597485145237,1 18,1 90),(164 31,46 31,40.2597485145236 32.1418070123307,35.3933982822018 35.3933982822018,32.1418070123307 40.2597485145237,31 46,31 90))'::GEOGRAPHY)
----
\x01\x05\x00\x00\x00\x02\x00\x00\x00\x01\x02\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x80d@\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x002@\x00\x00\x00\x00\x00\x00\xF0?\xB4 \xDE\xC1\xFD\x84(@<n\x02\xB7k\x22\x01@\xE4o\xD1\xFF\xD6\x92\x1D@\xE4o\xD1\xFF\xD6\x92\x15@\xE4o\xD1\xFF\xD6\x92\x15@\xE4o\xD1\xFF\xD6\x92\x1D@\xF8m\x02\xB7k\x22\x01@\xB4 \xDE\xC1\xFD\x84(@\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x002@\x00\x00\x00\x00\x00\x00\xF0?\x00\x00\x00\x00\x00\x80V@\x01\x02\x00\x00\x00\x07\x00\x00\x00\x00\x00\x00\x00\x00\x80d@\x00\x00\x00\x00\x00\x00?@\x00\x00\x00\x00\x00\x00G@\x00\x00\x00\x00\x00\x00?@\x1F\x88wp?!D@\xE4&p\xBB&\x12@@\xFE-\xFA\xDFZ\xB2A@\xFE-\xFA\xDFZ\xB2A@\xE4&p\xBB&\x12@@-\x88wp?!D@\x00\x00\x00\x00\x00\x00?@\x00\x00\x00\x00\x00\x00G@\x00\x00\x00\x00\x00\x00?@\x00\x00\x00\x00\x00\x80V@

query I
SELECT ST_ASBINARY('POLYGON((0 0,0 15,150 15,150 0,0 0),(20 20,50 20,50 50,20 50,20 20))'::GEOGRAPHY)
----
\x01\x03\x00\x00\x00\x02\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00.@\x00\x00\x00\x00\x00\xC0b@\x00\x00\x00\x00\x00\x00.@\x00\x00\x00\x00\x00\xC0b@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x004@\x00\x00\x00\x00\x00\x004@\x00\x00\x00\x00\x00\x00I@\x00\x00\x00\x00\x00\x004@\x00\x00\x00\x00\x00\x00I@\x00\x00\x00\x00\x00\x00I@\x00\x00\x00\x00\x00\x004@\x00\x00\x00\x00\x00\x00I@\x00\x00\x00\x00\x00\x004@\x00\x00\x00\x00\x00\x004@

query I
SELECT ST_ASBINARY('GEOMETRYCOLLECTION(LINESTRING(2.99 90,71 74,20 14,171 15.4),POINT(2.99 90),POLYGON((159.33 16.369,171 15.4,161.31 14.233,159.33 16.369)) )'::GEOGRAPHY)
----
\x01\x07\x00\x00\x00\x03\x00\x00\x00\x01\x02\x00\x00\x00\x04\x00\x00\x00\xECQ\xB8\x1E\x85\xEB\x07@\x00\x00\x00\x00\x00\x80V@\x00\x00\x00\x00\x00\xC0Q@\x00\x00\x00\x00\x00\x80R@\x00\x00\x00\x00\x00\x004@\x00\x00\x00\x00\x00\x00,@\x00\x00\x00\x00\x00`e@\xCD\xCC\xCC\xCC\xCC\xCC.@\x01\x01\x00\x00\x00\xECQ\xB8\x1E\x85\xEB\x07@\x00\x00\x00\x00\x00\x80V@\x01\x03\x00\x00\x00\x01\x00\x00\x00\x04\x00\x00\x00\xC3\xF5(\x5C\x8F\xEAc@X9\xB4\xC8v^0@\x00\x00\x00\x00\x00`e@\xCD\xCC\xCC\xCC\xCC\xCC.@R\xB8\x1E\x85\xEB)d@\x9E\xEF\xA7\xC6Kw,@\xC3\xF5(\x5C\x8F\xEAc@X9\xB4\xC8v^0@

query I
SELECT ST_ASBINARY(NULL)
----
NULL

query I
SELECT ST_ASBINARY('')
----
(empty)

#test with invalid input
statement error
SELECT ST_ASBINARY(22)
