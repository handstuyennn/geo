# name: test/sql/test_isempty.test
# description: ST_ISEMPTY test
# group: [sql]

statement ok
LOAD 'build/release/extension/geo/geo.duckdb_extension';

statement ok
PRAGMA enable_verification

#test with POINT
query I
SELECT ST_ISEMPTY('POINT EMPTY')
----
1

query I 
SELECT ST_ISEMPTY('010100000000000000000024400000000000004B40')
----
0

query I 
SELECT ST_ISEMPTY('{"type":"Point","coordinates":[-71.064544,10.2323]}')
----
0

#test with LINESTRING
query I
SELECT ST_ISEMPTY('LINESTRING EMPTY')
----
1

query I 
SELECT ST_ISEMPTY('010200000006000000e44a3d0b42ca51c06ec328081e21454027bf45274bca51c0f67b629d2a214540957cec2e50ca51c07099d3653121454047ded1e65dcb51c0781c510ef83145404871a7835dcb51c0ebdaee75f53145406285c7c15ecb51c0ed88fc0df5314540')
----
0

query I 
SELECT ST_ISEMPTY('{"type":"LineString","coordinates":[[1,1],[2,2],[3,3],[4,4]]}')
----
0

#test with POLYGON
query I
SELECT ST_ISEMPTY('POLYGON EMPTY')
----
1

query I 
SELECT ST_ISEMPTY('010300000001000000050000004a5349305fcb51c01c21e402f53145406ba94a2e5fcb51c048dc8411f8314540775e168b5dcb51c0988b2b0ff83145406a0561835dcb51c0bde47c00f53145404a5349305fcb51c01c21e402f5314540')
----
0

query I 
SELECT ST_ISEMPTY('{"type":"Polygon","coordinates":[[[0,0],[0,50],[150,50],[150,0],[0,0]],[[20,20],[50,20],[50,50],[20,50],[20,20]]]}')
----
0

#test with MULTIPOINT
query I
SELECT ST_ISEMPTY('MULTIPOINT EMPTY')
----
1

query I 
SELECT ST_ISEMPTY('0104000000060000000101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f0101000000cdccccccccccec3fcdccccccccccec3f')
----
0

query I 
SELECT ST_ISEMPTY('{"type":"MultiPoint","coordinates":[[35,14]]}')
----
0

#test with MULTILINESTRING
query I
SELECT ST_ISEMPTY('MULTILINESTRING EMPTY')
----
1

query I 
SELECT ST_ISEMPTY('01050000C00200000001020000C004000000000000000000000000000000000000000000000000000000000000000000F03F00000000000000000000000000001440000000000000000000000000000000400000000000001440000000000000000000000000000000000000000000000840000000000000000000000000000000000000000000000000000000000000104001020000C004000000000000000000F03F000000000000F03F0000000000000000000000000000F03F0000000000000840000000000000F03F0000000000000000000000000000F03F000000000000F03F00000000000008400000000000000000000000000000F03F000000000000F03F000000000000F03F0000000000000000000000000000F03F')
----
0

query I 
SELECT ST_ISEMPTY('{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237999999997]]]}')
----
0

#test with MULTIPOLYGON
query I
SELECT ST_ISEMPTY('MULTIPOLYGON EMPTY')
----
1

query I 
SELECT ST_ISEMPTY('0106000000030000000103000000020000000500000000000000000010400000000000000000000000000000000000000000000010C000000000000010C00000000000000000000000000000000000000000000010400000000000001040000000000000000005000000000000000000004000000000000000000000000000000000000000000000004000000000000000C00000000000000000000000000000000000000000000000C0000000000000004000000000000000000103000000020000000500000000000000000038400000000000000000000000000000344000000000000010C000000000000030400000000000000000000000000000344000000000000010400000000000003840000000000000000005000000000000000000364000000000000000000000000000003440000000000000004000000000000032400000000000000000000000000000344000000000000000C0000000000000364000000000000000000103000000020000000500000000000000000046400000000000000000000000000000444000000000000010C000000000000042400000000000000000000000000000444000000000000010400000000000004640000000000000000005000000000000000000454000000000000000000000000000004440000000000000004000000000000043400000000000000000000000000000444000000000000000C000000000000045400000000000000000')
----
0

query I 
SELECT ST_ISEMPTY('{"type":"MultiPolygon","coordinates":[[[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]],[[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,33]]]]}')
----
0

#test with COLLECTION
query I
SELECT ST_ISEMPTY('GEOMETRYCOLLECTION EMPTY')
----
1

query I 
SELECT ST_ISEMPTY('010700000002000000010300000001000000070000000282397afcca51c0d734ef38452d4540f303577902cb51c02aac5450512d4540130a117008cb51c0b9895a9a5b2d45408ae942acfeca51c0a30392b06f2d4540ee26f8a6e9ca51c03ae97de36b2d454042ec4ca1f3ca51c00f80b8ab572d45400282397afcca51c0d734ef38452d4540010200000003000000e44a3d0b42ca51c06ec328081e21454027bf45274bca51c0f67b629d2a214540957cec2e50ca51c07099d36531214540')
----
0

query I 
SELECT ST_ISEMPTY('{"type":"GeometryCollection","geometries":[{"type":"MultiPoint","coordinates":[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]]},{"type":"MultiLineString","coordinates":[[[-89.734634999999997,31.492072000000000],[-89.734955999999997,31.492237999999997]]]},{"type":"MultiPolygon","coordinates":[[[[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,32],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,32],[-117,32],[-117,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-116,32],[-117,32],[-117,32],[-117,32],[-117,32]],[[-117,33],[-117,33],[-117,33],[-117,33],[-117,33],[-117,32],[-117,33]]]]}]}')
----
0

#test with NULL and empty value
query I
SELECT ST_ISEMPTY('')
----
1

query I 
SELECT ST_ISEMPTY(NULL)
----
NULL

# test with invalid input
statement error
SELECT ST_ISEMPTY(22)

# test with table
statement ok
CREATE TABLE geographies (g Geography);

statement ok
INSERT INTO geographies VALUES('MULTIPOINT EMPTY'::GEOGRAPHY), ('010200000006000000e44a3d0b42ca51c06ec328081e21454027bf45274bca51c0f67b629d2a214540957cec2e50ca51c07099d3653121454047ded1e65dcb51c0781c510ef83145404871a7835dcb51c0ebdaee75f53145406285c7c15ecb51c0ed88fc0df5314540'), ('POLYGON((-71.040878 42.285678,-71.040943 42.2856,-71.04096 42.285752,-71.040878 42.285678))'::GEOGRAPHY), ('0101000000CB49287D21C451C0F0BF95ECD8A44540')

query R
SELECT ST_ISEMPTY(g) FROM geographies
----
1
0
0
0

statement ok
INSERT INTO geographies VALUES(''::GEOGRAPHY), (NULL::GEOGRAPHY), ('MULTIPOLYGON EMPTY')

query R
SELECT ST_ISEMPTY(g) FROM geographies
----
1
0
0
0
1
NULL
1
